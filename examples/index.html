<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ejemplo de Botón Flotante con Chat</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
    }
    
    .controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 8px 16px;
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #3a7bc8;
    }

    /* Estilos para el botón flotante */
    .floating-button {
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      position: fixed;
      z-index: 1000;
      outline: none;
      transition: all 0.3s ease;
      font-size: 24px;
    }
    
    .floating-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    
    .floating-button:active {
      transform: scale(0.95);
    }
    
    .floating-button.small {
      width: 40px;
      height: 40px;
      font-size: 18px;
    }
    
    .floating-button.medium {
      width: 56px;
      height: 56px;
      font-size: 24px;
    }
    
    .floating-button.large {
      width: 72px;
      height: 72px;
      font-size: 30px;
    }
    
    .floating-button.bottom-right {
      bottom: 20px;
      right: 20px;
    }
    
    .floating-button.bottom-left {
      bottom: 20px;
      left: 20px;
    }
    
    .floating-button.top-right {
      top: 20px;
      right: 20px;
    }
    
    .floating-button.top-left {
      top: 20px;
      left: 20px;
    }
    
    /* Estilo para el elemento de estado */
    .status {
      margin-top: 10px;
      padding: 8px;
      background-color: #f8f8f8;
      border-radius: 4px;
      border-left: 4px solid #4a90e2;
    }
    
    .status.error {
      border-left-color: #ff5252;
      background-color: #fff0f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Demostración del Botón Flotante con Chat</h1>
    <p>Este es un ejemplo de cómo usar los componentes FloatingButton y Chat. Haz clic en el botón flotante para abrir el chat.</p>
    <div id="status" class="status">Estado: Click en el botón flotante para abrir el chat</div>
    
    <div class="controls">
      <button onclick="cambiarPosicion()">Cambiar Posición</button>
      <button onclick="cambiarColor()">Cambiar Color</button>
      <button onclick="cambiarIcono()">Cambiar Icono</button>
      <button onclick="cambiarTamaño()">Cambiar Tamaño</button>
    </div>
    
    <div class="features" style="margin-top: 20px;">
      <h2>Características</h2>
      <ul>
        <li>Botón flotante personalizable (color, posición, tamaño, icono)</li>
        <li>Chat con interfaz elegante y amigable</li>
        <li>Burbujas de chat con diferentes estilos para usuario y asistente</li>
        <li>Efectos de escritura para simular respuestas en tiempo real</li>
        <li>Responsive y adaptable a dispositivos móviles</li>
        <li>Funciona con clics y con atajos de teclado (Enter para enviar)</li>
      </ul>
    </div>
  </div>

  <!-- Botón flotante manual -->
  <button id="floating-btn" class="floating-button medium bottom-right" style="background-color: #4a90e2; color: #ffffff;">
    💬
  </button>

  <script>
    // Variables globales
    let chat;
    
    // Obtener referencia al botón flotante
    const floatingBtn = document.getElementById('floating-btn');
    
    // Configuración actual
    let currentConfig = {
      position: 'bottom-right',
      size: 'medium',
      backgroundColor: '#4a90e2',
      color: '#ffffff',
      icon: '💬'
    };
    
    // Crear implementación manual del chat
    function createChat() {
      // Comprobar si ya existe el chat
      if (!chat) {
        chat = createChatComponent();
        chat.mount();
      }
    }
    
    function createChatComponent() {
      // Crear la estructura del chat
      const container = document.createElement('div');
      container.className = 'ia-chat-container';
      container.style.display = 'none';
      container.style.position = 'fixed';
      container.style.zIndex = '1001';
      container.style.pointerEvents = 'none';
      container.style.width = '100%';
      container.style.height = '100%';
      container.style.top = '0';
      container.style.left = '0';
      
      const chatWindow = document.createElement('div');
      chatWindow.className = `ia-chat-window ${currentConfig.position}`;
      chatWindow.style.position = 'absolute';
      chatWindow.style.width = '350px';
      chatWindow.style.height = '450px';
      chatWindow.style.backgroundColor = '#ffffff';
      chatWindow.style.borderRadius = '10px';
      chatWindow.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.2)';
      chatWindow.style.display = 'flex';
      chatWindow.style.flexDirection = 'column';
      chatWindow.style.overflow = 'hidden';
      chatWindow.style.pointerEvents = 'auto';
      chatWindow.style.transition = 'all 0.3s ease';
      
      // Ajustar posición
      if (currentConfig.position === 'bottom-right') {
        chatWindow.style.bottom = '90px';
        chatWindow.style.right = '20px';
      } else if (currentConfig.position === 'bottom-left') {
        chatWindow.style.bottom = '90px';
        chatWindow.style.left = '20px';
      } else if (currentConfig.position === 'top-right') {
        chatWindow.style.top = '20px';
        chatWindow.style.right = '20px';
      } else if (currentConfig.position === 'top-left') {
        chatWindow.style.top = '20px';
        chatWindow.style.left = '20px';
      }
      
      // Crear encabezado
      const header = document.createElement('div');
      header.style.backgroundColor = currentConfig.backgroundColor;
      header.style.color = 'white';
      header.style.padding = '12px 16px';
      header.style.display = 'flex';
      header.style.justifyContent = 'space-between';
      header.style.alignItems = 'center';
      
      const title = document.createElement('div');
      title.style.fontWeight = 'bold';
      title.style.fontSize = '16px';
      title.textContent = 'Asistente IA';
      
      const closeButton = document.createElement('button');
      closeButton.style.background = 'none';
      closeButton.style.border = 'none';
      closeButton.style.color = 'white';
      closeButton.style.fontSize = '24px';
      closeButton.style.cursor = 'pointer';
      closeButton.style.padding = '0';
      closeButton.style.marginLeft = '10px';
      closeButton.style.lineHeight = '1';
      closeButton.innerHTML = '&times;';
      closeButton.setAttribute('aria-label', 'Cerrar chat');
      
      header.appendChild(title);
      header.appendChild(closeButton);
      
      // Crear lista de mensajes
      const messageList = document.createElement('div');
      messageList.style.flex = '1';
      messageList.style.overflowY = 'auto';
      messageList.style.padding = '16px';
      messageList.style.display = 'flex';
      messageList.style.flexDirection = 'column';
      messageList.style.gap = '12px';
      
      // Crear área de entrada
      const inputArea = document.createElement('div');
      inputArea.style.padding = '12px';
      inputArea.style.borderTop = '1px solid #e0e0e0';
      inputArea.style.display = 'flex';
      inputArea.style.alignItems = 'flex-end';
      
      const textarea = document.createElement('textarea');
      textarea.style.flex = '1';
      textarea.style.border = '1px solid #e0e0e0';
      textarea.style.borderRadius = '20px';
      textarea.style.padding = '10px 14px';
      textarea.style.fontFamily = 'inherit';
      textarea.style.resize = 'none';
      textarea.style.maxHeight = '120px';
      textarea.style.overflowY = 'hidden';
      textarea.style.outline = 'none';
      textarea.style.transition = 'height 0.1s ease-out';
      textarea.placeholder = 'Escribe tu mensaje aquí...';
      textarea.rows = 1;
      // Forzar altura fija para evitar el cálculo automático de 35px
      textarea.style.height = '42px';
      textarea.style.minHeight = '42px';
      textarea.style.boxSizing = 'border-box';
      textarea.setAttribute('aria-label', 'Mensaje');
      
      // Wrapper para el textarea para mejor control
      const textareaWrapper = document.createElement('div');
      textareaWrapper.style.flex = '1';
      textareaWrapper.style.position = 'relative';
      textareaWrapper.style.display = 'flex';
      textareaWrapper.appendChild(textarea);
      
      const sendButton = document.createElement('button');
      sendButton.style.backgroundColor = currentConfig.backgroundColor;
      sendButton.style.color = 'white';
      sendButton.style.border = 'none';
      sendButton.style.borderRadius = '50%';
      sendButton.style.width = '40px';
      sendButton.style.height = '40px';
      sendButton.style.marginLeft = '8px';
      sendButton.style.cursor = 'pointer';
      sendButton.style.display = 'flex';
      sendButton.style.alignItems = 'center';
      sendButton.style.justifyContent = 'center';
      sendButton.style.fontSize = '18px';
      sendButton.innerHTML = '&#10148;';
      sendButton.setAttribute('aria-label', 'Enviar mensaje');
      
      inputArea.appendChild(textareaWrapper);
      inputArea.appendChild(sendButton);
      
      // Ensamblar componentes
      chatWindow.appendChild(header);
      chatWindow.appendChild(messageList);
      chatWindow.appendChild(inputArea);
      container.appendChild(chatWindow);
      
      // Agregar mensaje inicial
      addMessage(messageList, 'Hola, ¿en qué puedo ayudarte?', 'assistant');
      
      // Eventos
      let isOpen = false;
      
      // Función para abrir/cerrar
      function toggle() {
        isOpen = !isOpen;
        container.style.display = isOpen ? 'block' : 'none';
        
        if (isOpen) {
          // Enfocar el textarea cuando se abre
          setTimeout(() => {
            textarea.focus();
          }, 100);
          
          // Scroll al final
          messageList.scrollTop = messageList.scrollHeight;
        }
      }
      
      // Función para añadir mensajes
      function addMessage(container, text, type) {
        const message = document.createElement('div');
        message.style.padding = '10px 14px';
        message.style.borderRadius = '16px';
        message.style.maxWidth = '80%';
        message.style.wordBreak = 'break-word';
        message.style.lineHeight = '1.4';
        
        if (type === 'user') {
          message.style.backgroundColor = currentConfig.backgroundColor;
          message.style.color = 'white';
          message.style.alignSelf = 'flex-end';
          message.style.borderBottomRightRadius = '4px';
        } else if (type === 'assistant') {
          message.style.backgroundColor = '#f1f1f1';
          message.style.color = '#333333';
          message.style.alignSelf = 'flex-start';
          message.style.borderBottomLeftRadius = '4px';
        } else if (type === 'error') {
          message.style.backgroundColor = '#ffe6e6';
          message.style.color = '#d32f2f';
          message.style.alignSelf = 'flex-start';
          message.style.borderBottomLeftRadius = '4px';
        }
        
        message.textContent = text;
        container.appendChild(message);
        container.scrollTop = container.scrollHeight;
      }
      
      // Función para mostrar indicador de escritura
      function showTyping() {
        const typing = document.createElement('div');
        typing.id = 'typing-indicator';
        typing.style.padding = '8px 14px';
        typing.style.display = 'flex';
        typing.style.alignItems = 'center';
        typing.style.alignSelf = 'flex-start';
        typing.style.backgroundColor = '#f1f1f1';
        typing.style.borderRadius = '16px';
        typing.style.borderBottomLeftRadius = '4px';
        
        for (let i = 0; i < 3; i++) {
          const dot = document.createElement('span');
          dot.style.display = 'inline-block';
          dot.style.width = '8px';
          dot.style.height = '8px';
          dot.style.borderRadius = '50%';
          dot.style.backgroundColor = '#888';
          dot.style.margin = '0 4px';
          dot.style.animation = 'typing-dot 1.4s infinite ease-in-out both';
          dot.style.animationDelay = i * 0.2 + 's';
          typing.appendChild(dot);
        }
        
        messageList.appendChild(typing);
        messageList.scrollTop = messageList.scrollHeight;
      }
      
      // Función para ocultar indicador de escritura
      function hideTyping() {
        const typing = document.getElementById('typing-indicator');
        if (typing) typing.remove();
      }
      
      // Agregar eventos
      closeButton.addEventListener('click', toggle);
      
      // Control de altura del textarea
      function forceTextareaHeight(textarea, height) {
        textarea.style.height = height;
        textarea.style.minHeight = height;
        // Hacer el cambio atómico
        requestAnimationFrame(() => {
          textarea.style.height = height;
          textarea.style.minHeight = height;
        });
      }
      
      // Función para auto-ajustar el tamaño del textarea según el contenido
      function autoResizeTextarea() {
        // Primero restablecer altura para obtener un scrollHeight preciso
        textarea.style.height = '42px';
        
        // Obtener y aplicar nueva altura basada en el contenido
        const newHeight = Math.min(textarea.scrollHeight, 120);
        textarea.style.height = `${newHeight}px`;
        
        // Gestionar la clase multiline y el scroll
        if (newHeight > 42) {
          textarea.style.overflowY = newHeight >= 120 ? 'auto' : 'hidden';
        } else {
          textarea.style.overflowY = 'hidden';
        }
      }
      
      // Manejar eventos de teclado
      textarea.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        } else {
          // Para cualquier otra tecla, ajustar tamaño en el próximo ciclo
          setTimeout(autoResizeTextarea, 0);
        }
      });
      
      // Auto-ajustar en cada cambio de contenido
      textarea.addEventListener('input', autoResizeTextarea);
      
      // También ajustar al enfocar
      textarea.addEventListener('focus', autoResizeTextarea);
      
      sendButton.addEventListener('click', sendMessage);
      
      function sendMessage() {
        const message = textarea.value.trim();
        
        if (message) {
          // Agregar mensaje del usuario
          addMessage(messageList, message, 'user');
          
          // Limpiar input
          textarea.value = '';
          textarea.style.height = '42px'; // Restaurar altura inicial
          textarea.style.overflowY = 'hidden';
          
          // Mostrar indicador de escritura
          showTyping();
          
          // Simular respuesta después de un tiempo aleatorio
          setTimeout(() => {
            hideTyping();
            
            // Respuestas predefinidas para demostración
            let response;
            const lowerMsg = message.toLowerCase();
            
            if (lowerMsg.includes('hola') || lowerMsg.includes('saludos') || lowerMsg.includes('hey')) {
              response = '¡Hola! ¿En qué puedo ayudarte hoy?';
            } else if (lowerMsg.includes('ayuda') || lowerMsg.includes('ayudar')) {
              response = 'Estoy aquí para responder tus preguntas. ¿Qué necesitas saber?';
            } else if (lowerMsg.includes('gracias')) {
              response = '¡De nada! Estoy para ayudarte.';
            } else if (lowerMsg.includes('nombre')) {
              response = 'Soy un asistente de IA creado para ayudarte.';
            } else {
              response = 'Entiendo. ¿Puedes darme más detalles para ayudarte mejor?';
            }
            
            addMessage(messageList, response, 'assistant');
          }, 1000 + Math.random() * 1000);
        }
      }
      
      // Clic fuera para cerrar
      document.addEventListener('click', (e) => {
        if (isOpen && !container.contains(e.target) && e.target !== floatingBtn) {
          toggle();
        }
      });
      
      // Retornar objeto similar a la API del chat
      return {
        isOpen: () => isOpen,
        toggle,
        open: () => {
          if (!isOpen) toggle();
        },
        close: () => {
          if (isOpen) toggle();
        },
        mount: (target = document.body) => {
          target.appendChild(container);
        },
        unmount: () => {
          if (container.parentNode) {
            container.parentNode.removeChild(container);
          }
        }
      };
    }
    
    // Agregar funcionalidad de clic al botón flotante
    floatingBtn.addEventListener('click', () => {
      // Crear chat si no existe
      createChat();
      
      // Abrir/cerrar el chat
      chat.toggle();
      
      document.getElementById('status').textContent = 'Estado: ' + (chat.isOpen() ? 'Chat abierto' : 'Chat cerrado');
    });
    
    // Funciones para modificar el botón
    window.cambiarPosicion = function() {
      // Rotar entre posiciones
      const positions = ['bottom-right', 'bottom-left', 'top-left', 'top-right'];
      const currentIndex = positions.indexOf(currentConfig.position);
      const nextIndex = (currentIndex + 1) % positions.length;
      currentConfig.position = positions[nextIndex];
      
      // Quitar todas las clases de posición
      floatingBtn.classList.remove('bottom-right', 'bottom-left', 'top-left', 'top-right');
      // Agregar la nueva clase de posición
      floatingBtn.classList.add(currentConfig.position);
      
      // Actualizar chat si existe
      if (chat) {
        // Para un chat real, actualizaríamos la posición
        // En esta demostración, cerramos y recreamos el chat
        const wasOpen = chat.isOpen();
        chat.close();
        chat.unmount();
        chat = null;
        
        if (wasOpen) {
          createChat();
          chat.open();
        }
      }
      
      document.getElementById('status').textContent = 'Estado: Posición cambiada a ' + currentConfig.position;
    };
    
    window.cambiarColor = function() {
      // Cambiar entre colores predefinidos
      const colors = ['#4a90e2', 'black', '#4caf50', '#9c27b0'];
      const currentIndex = colors.indexOf(currentConfig.backgroundColor);
      const nextIndex = (currentIndex + 1) % colors.length;
      currentConfig.backgroundColor = colors[nextIndex];
      
      // Aplicar el nuevo color
      floatingBtn.style.backgroundColor = currentConfig.backgroundColor;
      
      // Actualizar chat si existe
      if (chat) {
        // Para un chat real, actualizaríamos el color
        // En esta demostración, cerramos y recreamos el chat
        const wasOpen = chat.isOpen();
        chat.close();
        chat.unmount();
        chat = null;
        
        if (wasOpen) {
          createChat();
          chat.open();
        }
      }
      
      document.getElementById('status').textContent = 'Estado: Color cambiado a ' + currentConfig.backgroundColor;
    };
    
    window.cambiarIcono = function() {
      // Cambiar entre iconos
      const icons = ['💬', '🤖', '🔔', '📱'];
      const currentIndex = icons.indexOf(currentConfig.icon);
      const nextIndex = (currentIndex + 1) % icons.length;
      currentConfig.icon = icons[nextIndex];
      
      // Aplicar el nuevo icono
      floatingBtn.innerHTML = currentConfig.icon;
      
      document.getElementById('status').textContent = 'Estado: Icono cambiado';
    };
    
    window.cambiarTamaño = function() {
      // Cambiar entre tamaños
      const sizes = ['small', 'medium', 'large'];
      const currentIndex = sizes.indexOf(currentConfig.size);
      const nextIndex = (currentIndex + 1) % sizes.length;
      currentConfig.size = sizes[nextIndex];
      
      // Quitar todas las clases de tamaño
      floatingBtn.classList.remove('small', 'medium', 'large');
      // Agregar la nueva clase de tamaño
      floatingBtn.classList.add(currentConfig.size);
      
      document.getElementById('status').textContent = 'Estado: Tamaño cambiado a ' + currentConfig.size;
    };
    
    // Agregar animación de typing dots
    const style = document.createElement('style');
    style.textContent = `
      @keyframes typing-dot {
        0%, 80%, 100% { transform: scale(0.7); opacity: 0.6; }
        40% { transform: scale(1); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html> 